image:
  repository: vllm/vllm-openai
  tag: gptoss
  pullPolicy: Always

replicaCount: 1

# GPU configuration
gpu:
  # Number of GPUs to request
  count: 1
  # Memory limit for the container (important for GPU workloads)
  memoryLimit: "100Gi"
  # CPU resources
  cpuLimit: "8"
  cpuRequest: "4"

# Model configuration
model:
  # Hugging Face model name - can be overridden
  name: "openai/gpt-oss-20b"
  # Model download directory
  downloadDir: "/models"
  # Tensor parallel size (should match GPU count)
  tensorParallelSize: 1

# Service configuration
service:
  type: LoadBalancer
  port: 8000
  targetPort: 8000
  # Set a specific IP from your MetalLB range
  loadBalancerIP: ""

# Resource requests and limits
resources:
  limits:
    nvidia.com/gpu: 1
    memory: "32Gi"
    cpu: "4"
  requests:
    nvidia.com/gpu: 1
    memory: "32Gi"
    cpu: "2"

# Node affinity and tolerations for GPU nodes
nodeSelector:
  gpu: "true"

# Persistent volume for model storage (optional)
persistence:
  enabled: true
  storageClass: "longhorn"
  size: "200Gi"
  accessMode: ReadWriteOnce

# Environment variables
env:
  - name: NVIDIA_VISIBLE_DEVICES
    value: "all"
  - name: NVIDIA_DRIVER_CAPABILITIES
    value: "compute,utility"
  - name: LD_LIBRARY_PATH
    value: "/usr/local/nvidia/lib64:/usr/local/cuda/lib64:$(LD_LIBRARY_PATH)"
  - name: VLLM_ATTENTION_BACKEND
    value: "TRITON_ATTN_VLLM_V1"

# Security context
securityContext:
  runAsNonRoot: false
  runAsUser: 0

# Runtime class for NVIDIA GPU support
runtimeClassName: nvidia

# Volume mounts for shared memory and NVIDIA libraries
volumeMounts:
  - name: shm
    mountPath: /dev/shm
  - name: nvidia-libs
    mountPath: /usr/lib/x86_64-linux-gnu
    readOnly: true
  - name: nvidia-driver
    mountPath: /usr/local/nvidia
    readOnly: true

# Volumes for shared memory and NVIDIA libraries
volumes:
  - name: shm
    emptyDir:
      medium: Memory
      sizeLimit: "2Gi"
  - name: nvidia-libs
    hostPath:
      path: /usr/lib/x86_64-linux-gnu
  - name: nvidia-driver
    hostPath:
      path: /usr/local/nvidia