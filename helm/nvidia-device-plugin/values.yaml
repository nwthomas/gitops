image:
  repository: nvcr.io/nvidia/k8s-device-plugin
  tag: v0.17.1
  pullPolicy: IfNotPresent

nodeSelector:
  # Target GPU nodes specifically
  kubernetes.io/arch: amd64
  gpu: "true"

resources:
  limits:
    memory: 128Mi
    cpu: 100m
  requests:
    memory: 64Mi
    cpu: 50m

# Security context for the device plugin
securityContext:
  privileged: true

# Tolerations for GPU nodes
tolerations:
  - key: gpu
    operator: Equal
    value: "true"
    effect: NoExecute

# Environment variables for nvidia-device-plugin
env:
  - name: DEVICE_DISCOVERY_STRATEGY
    value: "tegra"  # Use tegra discovery strategy
  - name: DEVICE_LIST_STRATEGY
    value: "envvar"  # Use envvar for device list strategy
  - name: DEVICE_ID_STRATEGY
    value: "uuid"
  - name: NVIDIA_VISIBLE_DEVICES
    value: "all"
  - name: NVIDIA_DRIVER_CAPABILITIES
    value: "compute,utility"

# Mount the NVIDIA libraries and device files
volumeMounts:
  - name: device-plugin
    mountPath: /var/lib/kubelet/device-plugins
  - name: dev
    mountPath: /dev

volumes:
  - name: device-plugin
    hostPath:
      path: /var/lib/kubelet/device-plugins
  - name: dev
    hostPath:
      path: /dev